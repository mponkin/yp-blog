# Проект модуля 3 - Блог

## Состав проекта

В проект входят следующие крейты:
- blog-server - сервер блога, предоставляющий HTTP и gRPC API с возможностями для ведения блога (регистрация, авторизация пользователей, просмотр, написание, редактирование и удаление постов)
- blog-grpc-api - крейт содержит код gRPC клиента и сервера, сгенерированный из proto-файла, используется для устранения дублирования в клиенте и сервере
- blog-client - библиотека клиента блога для подключения к серверу через HTTP или gRPC API 
- blog-cli - консольное приложение - клиент блога
- blog-wasm - WASM фронтенд для блога

## Запуск сервера

Перед запуском необходимо выполнить следующие шаги:
1. Выполнить сборку доступных приложений командой `cargo build --workspace --release`
2. Сгенерировать JWT-secret, например, командой `openssl rand -base64 32`
3. Экспортировать полученный в п.2 токен `export JWT_SECRET=<полученный токен>`
4. Поднять БД postgresql, например используя docker и команду `docker run -d --name blog-db -e POSTGRES_USER=blog -e POSTGRES_PASSWORD=blog -e POSTGRES_DB=blog -p 5432:5432 -v postgres_data:/var/lib/postgresql/data postgres:17-alpine`, опциональ можно поменять порт, логин, пароль а так же название базы для блога
5. Экспортировать адрес БД командой `export DATABASE_URL=postgresql://blog:blog@127.0.0.1:5432/blog` (учитывая опциональные изменения из п.4)
6. Опционально: задать фильтр логирования в формате env-logger и экспортировать его, например `export RUST_LOG=actix_web=TRACE,tonic=INFO,blog_server=TRACE`
7. Запустить сервер командой `./target/blog-server`. Команда принимает опциональные параметры --http_port и --grpc_port, значения по умолчанию 8080 и 50051 соответственно

## Тест сервера

На данном этапе можно протестировать минимальную работспособность сервера при помощи команды `curl http://127.0.0.1:8080/api/posts`, ожидаемый ответ `{"posts":[],"total_posts":0,"limit":10,"offset":0}`

Более подробно можно протестировать используя: 
 * [HTTP клиент Bruno](https://www.usebruno.com/), примеры запросов для которого находятся в папке `bruno`
 * `curl` (API соответствует описанному в задании)

## Запуск и использование CLI-клиента

Запуск осуществляется командой `./target/release/blog-cli`, доступные следующие параметры:
|Параметр|Комментарий|
|-|-|
|--server <URL>|установить адрес сервера (по умолчанию http://127.0.0.1:8080 для HTTP и :50051 для gRPC)|
|--grpc| сдалть запрос используся gRPC (по умолчанию используется HTTP)|

И вызвать действие используя субкоманду
|Описание|Субкоманда и параметры|Результат|
|-|-|-|
| Регистрация нового пользователя | register --username "USERNAME" --email "EMAIL" --password "PASSWORD" | Регистрация пользователя с указанными данными и сохранение токена для последующих запросов |
| Логин | login --username "USERNAME" --password "PASSWORD" |  Авторизация пользователя с указанными данными и сохранение токена для последующих запросов |
| Логаут | logout | Удаление сохраненного токена (если был) |
| Создание поста | create --title "Мой первый пост" --content "Содержание" | Возвращает созданный пост в JSON формате, требует наличия сохраненного токена |
| Получение поста | get --id POST_ID | пост в JSON формате |
| Редактирование поста | update --id POST_ID --title "Мой первый пост" --content "Содержание"| обновленный пост в JSON формате, требует наличия сохраненного токена, соответствующего юзеру автора поста |
| Удаление поста | delete --id | требует наличия сохраненного токена, соответствующего юзеру автора поста |
| Список постов | blog-cli list --limit 20 --offset 0 | Список постов в JSON формате, параметры --limit и --offset являются необязательными |

### Примеры команд

Выполнять из папки `./target/release` или добавлять адрес папки в начале команды

- `./blog-cli register --username "ivan" --email "ivan@example.com" --password "secret123"`
- `./blog-cli login --username "ivan" --password "secret123"`
- `./blog-cli create --title "Мой первый пост" --content "Содержание"`
- `./blog-cli get --id 1 --grpc`
- `./blog-cli update --id 1 --title "Обновлённый заголовок" --content "Обновленное сожержание"`
- `./blog-cli delete --id 1`
- `./blog-cli list --limit 20 --offset 0`

## Сборка и запуск WASM клиента

1. Перейти в корень репозитория и оттуда в папку `./blog-wasm`
2. Собрать проект командой `wasm-pack build --target web`
3. Опционально: указать адрес сервера в файле `index.html` на строке 46 
4. Запустить любой веб-сервер в данной папке, например `python3 -m http.server`
5. Запустить браузер и перейти по адресу [http://localhost:8000]

В WASM фронтенде доступны все те же действия: регистрация, логин-логаут, просмотр, написание, редактирование и удаление  постов. Так же в списке присутствует пагинация, если постов много (больше 5)